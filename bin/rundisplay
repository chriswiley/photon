#!/bin/sh
screen=:$1
port=`expr 5900 + $1`
type="$2"display
hd=$3

xpidfile=/var/photon/run/xserver-$1.pid

if [ "$3" = "hd" ]; then
  resolution="1280x720x24"
  flags="-h"
else
  resolution="640x480x24"
  flags=""
fi

if [ -e $xpidfile ]; then
  kill `cat $xpidfile`
fi

Xvfb $screen -screen 0 $resolution -nocursor -noreset -v &

echo $! > $xpidfile

sleep 5

x11vnc -display $screen -bg -nopw -rfbport $port -viewonly -forever -shared -nocursor &

xsetroot -display $screen -cursor /usr/photon/lib/images/blnk_ptr.xbm /usr/photon/lib/images/blnk_ptr.xbm

while /usr/bin/true; do
  /usr/photon/bin/$type -display $screen -- "$flags" -p $4
  xsetroot -display $screen -solid red
  sleep 5
  xsetroot -display $screen -solid blue
done
