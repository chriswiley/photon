namespace eval ::Lightmaster {
  
proc reset_state {} {
  set reset_channel 10
  toggle_channel $reset_channel
}

proc start_idle {} {
  ::warninglog "Lightmaster -> IDLE"
  set idle_channel 9
  reset_state
  toggle_channel $idle_channel
}

proc start_game { track } {
  ::warninglog "Lightmaster -> $track"
  reset_state
  toggle_channel $track
}

proc toggle_channel { channel } {
  set command "/usr/local/bin/ola_set_dmx"
  set lightcommand [list exec $command "-u" "0" "-d" [channel_string $channel]]
  if [ catch $lightcommand err ] {
    ::warninglog "$err running $lightcommand"
  }
}

proc channel_string { channel } {
  set off 0
  set on 255
  for { set ch 1 } { $ch < $channel } { incr ch } {
    append output $off ","
  }
  append output $on
  return $output
}

}